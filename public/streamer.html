<!DOCTYPE html>
<html>
<head>
    <title>Streamer (Phone)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/peerjs/1.4.7/peerjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>
<body>
    <video id="video" autoplay playsinline></video>
    <div id="qrcode"></div>
    <script>
        const peer = new Peer(); // Auto-generates ID
        const roomId = Math.random().toString(36).substring(7); // Unique room ID
        const video = document.getElementById('video');

        // Get camera stream
        navigator.mediaDevices.getUserMedia({ video: true, audio: false })
            .then(stream => {
                video.srcObject = stream;
                peer.on('call', call => {
                    call.answer(stream); // Send stream to caller
                });
            });

        // Generate QR code with viewer link (e.g., http://localhost:3000/viewer.html?room=abc123)
        const qr = new QRCode(document.getElementById('qrcode'), {
            text: `${window.location.origin}/viewer.html?room=${roomId}`,
            width: 256,
            height: 256
        });

        // Join signaling room
        const socket = io();
        peer.on('open', id => socket.emit('join-room', roomId, id));
    </script>
</body>
</html>
